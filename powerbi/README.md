# Power BI report guide (f1-fantasy-optimizer)

This repo is designed to be PowerBI-friendly: raw data is stored as long-format CSVs, and the pipeline will emit derived metrics/recommendations as CSVs.

## Recommended model (star schema)

### Dimensions
- **DimRound**: season + round (+ optional raceName/date via `dim_round_dates.csv`)
- **DimDriver**: driver id, abbreviation, name (optional)
- **DimConstructor**: constructor id, abbreviation, name (optional)

### Facts (long)
- **FactDriverPrices**: `f1fantasytools_prices_drivers_long.csv`
- **FactConstructorPrices**: `f1fantasytools_prices_constructors_long.csv`
- **FactDriverPoints**: `f1fantasytools_points_drivers_long.csv`
- **FactConstructorPoints**: `f1fantasytools_points_constructors_long.csv`

### Future facts (generated by the optimizer)
- `data/seasons/2025/derived/driver_metrics.csv`
- `data/seasons/2025/derived/constructor_metrics.csv`
- `data/seasons/2025/derived/team_recommendations.csv`

## Import steps (Power BI Desktop on Windows)

1) **Get Data → Text/CSV**
2) Pick each CSV in `data/seasons/2025/raw/`.
3) In Power Query:
   - Ensure `season` and `round` are Whole Number
   - Ensure `price`, `priceChange`, `totalPoints`, `nnTotalPoints` are Decimal/Whole Number
   - Replace literal `$undefined` with blank/null (Transform → Replace Values)
4) Create relationships:
   - DimRound[season_round] → Fact* [season_round]
   - DimDriver[driver_id] → FactDriver* [id]
   - DimConstructor[constructor_id] → FactConstructor* [id]

5) (Recommended) Add race dates:
   - Import `data/seasons/2025/raw/dim_round_dates.csv`
   - Merge into `DimRound` on (season, round)
   - Then create a Calendar table and relate Calendar[Date] → DimRound[raceDate]

## Suggested visuals

### Prices
- Line chart: Avg driver price by round
- Small multiples: price trend by driver
- Heatmap (matrix): driver vs round with price

### Points
- Line chart: totalPoints by round (driver/constructor)
- Bar chart: cumulative points by driver
- Scatter: price vs points (value)

### Optimizer outputs (once implemented)
- Table: recommended team per round
- Line: expected points vs actual points (if you later log actual)

## Power Query helpers

See `powerbi/powerquery_snippets.md` for:
- `$undefined` → null replacement
- adding `season_round`
- type conversions
- merging race dates into DimRound

## DAX measure ideas

See `powerbi/dax.md`.
